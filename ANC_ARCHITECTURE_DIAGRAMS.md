# ANC Proposal Engine - Architecture Diagram

## System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           PROPOSAL GENERATION FLOW                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                             â”‚   USER STARTS   â”‚
                             â”‚  ANC CHAT ROOM  â”‚
                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                     â”‚  DISPLAYS WELCOME MESSAGE      â”‚
                     â”‚  Prompts: "What do you need?"  â”‚
                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚    USER TYPES PROPOSAL DETAILS        â”‚
                  â”‚    "40x20 outdoor, 10mm pitch..."     â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  MESSAGE SENT TO BACKEND         â”‚
                    â”‚  Role: "user"                    â”‚
                    â”‚  Content: User's message         â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚              SYSTEM PROMPT PROCESSING                  â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
          â”‚  â”‚ 1. UNDERSTAND INPUT                              â”‚  â”‚
          â”‚  â”‚    Extract: width, height, environment, etc.     â”‚  â”‚
          â”‚  â”‚                                                   â”‚  â”‚
          â”‚  â”‚ 2. DETERMINE WHAT'S MISSING                       â”‚  â”‚
          â”‚  â”‚    Already have: width, height, environment      â”‚  â”‚
          â”‚  â”‚    Still need: pixel pitch, installation, etc.   â”‚  â”‚
          â”‚  â”‚                                                   â”‚  â”‚
          â”‚  â”‚ 3. GENERATE RESPONSE                              â”‚  â”‚
          â”‚  â”‚    Ask ONE next question about missing field      â”‚  â”‚
          â”‚  â”‚                                                   â”‚  â”‚
          â”‚  â”‚ 4. OUTPUT JSON BLOCK (CRITICAL)                   â”‚  â”‚
          â”‚  â”‚    ```json                                        â”‚  â”‚
          â”‚  â”‚    {                                              â”‚  â”‚
          â”‚  â”‚      "width": 40,                                 â”‚  â”‚
          â”‚  â”‚      "height": 20,                                â”‚  â”‚
          â”‚  â”‚      "environment": "Outdoor",                    â”‚  â”‚
          â”‚  â”‚      "screenArea": 800                            â”‚  â”‚
          â”‚  â”‚    }                                              â”‚  â”‚
          â”‚  â”‚    ```                                            â”‚  â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  AI RESPONSE SENT   â”‚
                    â”‚  Natural language + â”‚
                    â”‚  JSON code block    â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   MESSAGE IN CHAT HISTORY   â”‚
                â”‚   {                         â”‚
                â”‚     role: "assistant",      â”‚
                â”‚     content: "Great! I'd... â”‚
                â”‚     ```json{...}```"        â”‚
                â”‚   }                         â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     FRONTEND JSON PARSING (useEffect)   â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚  â”‚ 1. CHECK LAST MESSAGE              â”‚   â”‚
          â”‚  â”‚    Verify: role === 'assistant'   â”‚   â”‚
          â”‚  â”‚                                    â”‚   â”‚
          â”‚  â”‚ 2. REGEX SEARCH                     â”‚   â”‚
          â”‚  â”‚    Pattern: /```json...```/        â”‚   â”‚
          â”‚  â”‚                                    â”‚   â”‚
          â”‚  â”‚ 3. JSON PARSE                       â”‚   â”‚
          â”‚  â”‚    try { JSON.parse(match) }       â”‚   â”‚
          â”‚  â”‚                                    â”‚   â”‚
          â”‚  â”‚ 4. UPDATE STATE                     â”‚   â”‚
          â”‚  â”‚    setQuoteData(prev => {          â”‚   â”‚
          â”‚  â”‚      ...prev,                      â”‚   â”‚
          â”‚  â”‚      ...jsonData                   â”‚   â”‚
          â”‚  â”‚    })                              â”‚   â”‚
          â”‚  â”‚                                    â”‚   â”‚
          â”‚  â”‚ 5. AUTO-OPEN SLIDER                â”‚   â”‚
          â”‚  â”‚    setPreviewSliderOpen(true)      â”‚   â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚     HIDE JSON FROM USER VIEW            â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
          â”‚  â”‚ In HistoricalMessage component:    â”‚   â”‚
          â”‚  â”‚ - Detect: lang === "json"          â”‚   â”‚
          â”‚  â”‚ - Check: content includes "width"  â”‚   â”‚
          â”‚  â”‚ - Return: null (hidden)            â”‚   â”‚
          â”‚  â”‚                                    â”‚   â”‚
          â”‚  â”‚ Result:                            â”‚   â”‚
          â”‚  â”‚ User sees: "Great! I'd..."         â”‚   â”‚
          â”‚  â”‚ User doesn't see: JSON block       â”‚   â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚    RENDER PROPOSAL PREVIEW SLIDER       â”‚
          â”‚                                         â”‚
          â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
          â”‚  â•‘ ğŸ“‹ PROPOSAL PREVIEW             â•‘   â”‚
          â”‚  â•‘ Stadium Name                    â•‘   â”‚
          â”‚  â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢   â”‚
          â”‚  â•‘ [Specs  ] [Pricing]             â•‘   â”‚
          â”‚  â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢   â”‚
          â”‚  â•‘ Width: 40 ft                    â•‘   â”‚
          â”‚  â•‘ Height: 20 ft                   â•‘   â”‚
          â”‚  â•‘ Environment: Outdoor            â•‘   â”‚
          â”‚  â•‘ Screen Area: 800 sqft           â•‘   â”‚
          â”‚  â•Ÿâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â•¢   â”‚
          â”‚  â•‘ [Generate Excel] [Download PDF] â•‘   â”‚
          â”‚  â•‘    (disabled until complete)    â•‘   â”‚
          â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
          â”‚                                         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  USER PROVIDES NEXT   â”‚
                   â”‚  ANSWER: "10mm pitch" â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  CYCLE REPEATS      â”‚
                    â”‚  Until all fields   â”‚
                    â”‚  are complete       â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  ALL DATA COMPLETE              â”‚
              â”‚  - Width âœ“                      â”‚
              â”‚  - Height âœ“                     â”‚
              â”‚  - Environment âœ“               â”‚
              â”‚  - Pixel Pitch âœ“                â”‚
              â”‚  - Pricing âœ“                    â”‚
              â”‚  - All required fields âœ“        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  SLIDER BUTTONS ENABLED         â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
              â”‚  â”‚ âœ… Generate Excel Audit  â”‚   â”‚
              â”‚  â”‚ âœ… Download PDF          â”‚   â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  USER CLICKS "DOWNLOAD PDF"         â”‚
              â”‚                                     â”‚
              â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
              â”‚  â”‚ 1. VALIDATE DATA            â”‚    â”‚
              â”‚  â”‚    hasMinimumQuoteData()    â”‚    â”‚
              â”‚  â”‚                             â”‚    â”‚
              â”‚  â”‚ 2. API CALL                 â”‚    â”‚
              â”‚  â”‚    POST /api/workspace/     â”‚    â”‚
              â”‚  â”‚        {slug}/              â”‚    â”‚
              â”‚  â”‚        generate-proposal    â”‚    â”‚
              â”‚  â”‚    Body: {                  â”‚    â”‚
              â”‚  â”‚      width, height, ...     â”‚    â”‚
              â”‚  â”‚      outputFormat: 'pdf'    â”‚    â”‚
              â”‚  â”‚    }                        â”‚    â”‚
              â”‚  â”‚                             â”‚    â”‚
              â”‚  â”‚ 3. LOADING STATE            â”‚    â”‚
              â”‚  â”‚    setGeneratingProposal()  â”‚    â”‚
              â”‚  â”‚    Show spinner on button   â”‚    â”‚
              â”‚  â”‚                             â”‚    â”‚
              â”‚  â”‚ 4. BACKEND GENERATION       â”‚    â”‚
              â”‚  â”‚    PDF Service creates...   â”‚    â”‚
              â”‚  â”‚    - Renders proposal HTML  â”‚    â”‚
              â”‚  â”‚    - Adds branding          â”‚    â”‚
              â”‚  â”‚    - Compiles to PDF        â”‚    â”‚
              â”‚  â”‚    - Returns download URL   â”‚    â”‚
              â”‚  â”‚                             â”‚    â”‚
              â”‚  â”‚ 5. BROWSER DOWNLOAD         â”‚    â”‚
              â”‚  â”‚    Create <a> element       â”‚    â”‚
              â”‚  â”‚    Set href to URL          â”‚    â”‚
              â”‚  â”‚    Trigger click            â”‚    â”‚
              â”‚  â”‚    File downloads           â”‚    â”‚
              â”‚  â”‚                             â”‚    â”‚
              â”‚  â”‚ 6. SUCCESS FEEDBACK         â”‚    â”‚
              â”‚  â”‚    toast.success(...)       â”‚    â”‚
              â”‚  â”‚    "PDF downloaded!"        â”‚    â”‚
              â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚  PDF DOWNLOADED TO    â”‚
                   â”‚  USER'S COMPUTER      â”‚
                   â”‚  Ready to send to     â”‚
                   â”‚  customer             â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   FRONTEND APPLICATION                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            ChatContainer (Main Component)                â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  STATE:                                                 â”‚   â”‚
â”‚  â”‚  â”œâ”€ chatHistory[]          (chat messages)              â”‚   â”‚
â”‚  â”‚  â”œâ”€ quoteData{}            (proposal data)              â”‚   â”‚
â”‚  â”‚  â”œâ”€ previewSliderOpen      (slider visibility)          â”‚   â”‚
â”‚  â”‚  â””â”€ generatingProposal     (loading state)              â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  EFFECTS:                                               â”‚   â”‚
â”‚  â”‚  â””â”€ useEffect([chatHistory])                            â”‚   â”‚
â”‚  â”‚     â””â”€ Parse JSON blocks                                â”‚   â”‚
â”‚  â”‚     â””â”€ Update quoteData                                 â”‚   â”‚
â”‚  â”‚     â””â”€ Auto-open slider                                 â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  HANDLERS:                                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ handleGenerateExcel()                               â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ POST to /api/generate-proposal                   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Download Excel                                   â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â””â”€ handleDownloadPdf()                                 â”‚   â”‚
â”‚  â”‚     â””â”€ POST to /api/generate-proposal                   â”‚   â”‚
â”‚  â”‚     â””â”€ Download PDF                                     â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  CHILD COMPONENTS:                                      â”‚   â”‚
â”‚  â”‚  â”œâ”€ ChatHistory (messages)                              â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ HistoricalMessage (per message)                  â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ [JSON blocks hidden here]                     â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â”œâ”€ PromptInput (user input)                            â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â””â”€ ProposalPreviewSlider â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚   â”‚
â”‚  â”‚     Props:                                   â”‚           â”‚   â”‚
â”‚  â”‚     â”œâ”€ quoteData                            â”‚           â”‚   â”‚
â”‚  â”‚     â”œâ”€ isOpen                               â”‚           â”‚   â”‚
â”‚  â”‚     â”œâ”€ onToggle                             â”‚           â”‚   â”‚
â”‚  â”‚     â”œâ”€ onGenerateExcel                      â”‚           â”‚   â”‚
â”‚  â”‚     â”œâ”€ onDownloadPdf                        â”‚           â”‚   â”‚
â”‚  â”‚     â””â”€ isGenerating                         â”‚           â”‚   â”‚
â”‚  â”‚                                              â”‚           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                 â”‚               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚      ProposalPreviewSlider (Right Sidebar)             â”‚   â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  PROPS: (received from ChatContainer)                   â”‚   â”‚
â”‚  â”‚  â”œâ”€ quoteData: { width, height, env, ... }             â”‚   â”‚
â”‚  â”‚  â”œâ”€ isOpen: boolean                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ onToggle: function                                  â”‚   â”‚
â”‚  â”‚  â”œâ”€ onGenerateExcel: async function                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ onDownloadPdf: async function                       â”‚   â”‚
â”‚  â”‚  â””â”€ isGenerating: boolean                               â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  STATE: (internal)                                      â”‚   â”‚
â”‚  â”‚  â””â”€ activeTab: 'specs' | 'pricing'                      â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  UI STRUCTURE:                                          â”‚   â”‚
â”‚  â”‚  â”œâ”€ Toggle Button (left edge)                           â”‚   â”‚
â”‚  â”‚  â”œâ”€ Header (blue gradient)                              â”‚   â”‚
â”‚  â”‚  â”œâ”€ Tabbed Interface                                    â”‚   â”‚
â”‚  â”‚  â”‚  â”œâ”€ Specs Tab:                                       â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Width                                         â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Height                                        â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Environment                                   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Pixel Pitch                                   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â”œâ”€ Screen Area                                   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  â””â”€ Product Category                              â”‚   â”‚
â”‚  â”‚  â”‚  â”‚                                                    â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€ Pricing Tab:                                     â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Hardware Cost                                 â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Structural Cost                               â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Labor Cost                                    â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ PM Fee                                        â”‚   â”‚
â”‚  â”‚  â”‚     â”œâ”€ Total Cost (subtotal)                         â”‚   â”‚
â”‚  â”‚  â”‚     â””â”€ Final Client Price (highlighted)              â”‚   â”‚
â”‚  â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  â””â”€ Action Buttons                                      â”‚   â”‚
â”‚  â”‚     â”œâ”€ Generate Excel (enabled when complete)           â”‚   â”‚
â”‚  â”‚     â””â”€ Download PDF (enabled when complete)             â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â”‚  RESPONSIVE DESIGN:                                     â”‚   â”‚
â”‚  â”‚  â”œâ”€ Desktop: Fixed sidebar 384px wide                   â”‚   â”‚
â”‚  â”‚  â””â”€ Mobile: Full-width overlay                          â”‚   â”‚
â”‚  â”‚                                                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DATA FLOW DIAGRAM                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

1. INPUT LAYER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   User Messages              â”‚
   â”‚   {"type": "user",           â”‚
   â”‚    "content": "..."}         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
2. AI PROCESSING
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   System Prompt              â”‚
   â”‚   (ANC_SYSTEM_PROMPT.md)     â”‚
   â”‚                              â”‚
   â”‚   - Extract information      â”‚
   â”‚   - Ask adaptive questions   â”‚
   â”‚   - Generate response        â”‚
   â”‚   - Output JSON block        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
3. RESPONSE LAYER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   AI Response with JSON      â”‚
   â”‚   {"type": "assistant",      â”‚
   â”‚    "content": "Great!...     â”‚
   â”‚    ```json{...}```"}         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
4. STORAGE LAYER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   chatHistory (Array)        â”‚
   â”‚   [                          â”‚
   â”‚     {role, content, ...},    â”‚
   â”‚     {role, content, ...},    â”‚
   â”‚     ...                      â”‚
   â”‚   ]                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
5. PARSING LAYER (useEffect)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   Detect chatHistory change  â”‚
   â”‚   Get last message           â”‚
   â”‚   Regex match JSON block     â”‚
   â”‚   JSON.parse()               â”‚
   â”‚   Validate fields            â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
6. STATE UPDATE LAYER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   setQuoteData(prev => {     â”‚
   â”‚     ...prev,                 â”‚
   â”‚     ...jsonData              â”‚
   â”‚   })                         â”‚
   â”‚                              â”‚
   â”‚   setPreviewSliderOpen(true) â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
7. DISPLAY LAYER (Component)
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   ProposalPreviewSlider      â”‚
   â”‚   Receives quoteData         â”‚
   â”‚   Renders:                   â”‚
   â”‚   - Specs tab                â”‚
   â”‚   - Pricing tab              â”‚
   â”‚   - Action buttons           â”‚
   â”‚   - Auto-calculated prices   â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
8. USER INTERACTION
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   User clicks:               â”‚
   â”‚   [Generate Excel] or        â”‚
   â”‚   [Download PDF]             â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
9. API CALL LAYER
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚   POST /api/workspace/:slug/ â”‚
   â”‚   generate-proposal          â”‚
   â”‚                              â”‚
   â”‚   {                          â”‚
   â”‚     width, height,           â”‚
   â”‚     environment, pixelPitch, â”‚
   â”‚     outputFormat,            â”‚
   â”‚     margin                   â”‚
   â”‚   }                          â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
10. FILE GENERATION (Backend)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   AncPricingEngine           â”‚
    â”‚   Calculate costs            â”‚
    â”‚                              â”‚
    â”‚   ExcelJS / Playwright       â”‚
    â”‚   Generate file              â”‚
    â”‚                              â”‚
    â”‚   Return: {                  â”‚
    â”‚     success: true,           â”‚
    â”‚     downloadUrl,             â”‚
    â”‚     filename                 â”‚
    â”‚   }                          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
11. DOWNLOAD LAYER
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Browser creates <a>        â”‚
    â”‚   Sets href to downloadUrl   â”‚
    â”‚   Triggers click()           â”‚
    â”‚   File downloads             â”‚
    â”‚   User receives PDF/Excel    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Utility Functions Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      quoteDataParser.js Functions              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

extractJsonFromMessage(message)
â”‚
â”œâ”€ INPUT: message (string from chat)
â”‚
â”œâ”€ PROCESS:
â”‚  â””â”€ Regex: /```json\s*\n?([\s\S]*?)\n?```/
â”‚     â””â”€ Match code block with JSON language
â”‚
â”œâ”€ PARSE:
â”‚  â””â”€ JSON.parse(match[1].trim())
â”‚
â””â”€ OUTPUT: {width: 40, height: 20, ...} or null


mergeQuoteData(existing, newData)
â”‚
â”œâ”€ INPUT: 
â”‚  â”œâ”€ existing: {width: 40, height: 20}
â”‚  â””â”€ newData: {environment: "Outdoor"}
â”‚
â”œâ”€ PROCESS:
â”‚  â”œâ”€ Create copy of existing
â”‚  â”œâ”€ Allowed fields whitelist check
â”‚  â”œâ”€ Merge only non-null values
â”‚
â””â”€ OUTPUT: {width: 40, height: 20, environment: "Outdoor"}


hasMinimumQuoteData(quoteData)
â”‚
â”œâ”€ INPUT: {width: 40, height: 20, environment: "Outdoor", ...}
â”‚
â”œâ”€ CHECK:
â”‚  â”œâ”€ width > 0? âœ“
â”‚  â”œâ”€ height > 0? âœ“
â”‚  â”œâ”€ environment exists? âœ“
â”‚  â”œâ”€ pixelPitch exists? âœ“
â”‚  â””â”€ finalPrice > 0? âœ“
â”‚
â””â”€ OUTPUT: boolean (enable/disable buttons)


removeJsonBlockFromText(message)
â”‚
â”œâ”€ INPUT: "Great! Here's...\n```json{...}```"
â”‚
â”œâ”€ PROCESS:
â”‚  â””â”€ Remove: /```json\s*\n?[\s\S]*?\n?```/g
â”‚
â””â”€ OUTPUT: "Great! Here's..." (unused)
```

---

## State Management Flow

```
ChatContainer State Changes:

Initial State:
â”œâ”€ chatHistory: []
â”œâ”€ quoteData: {}
â”œâ”€ previewSliderOpen: false
â””â”€ generatingProposal: false

User sends message:
â””â”€ chatHistory updated with user message
â””â”€ chatHistory updated with pending assistant message

AI responds:
â””â”€ chatHistory updated with assistant message (with JSON)
â””â”€ useEffect triggers (dependency: chatHistory)
   â”œâ”€ Detects JSON block
   â”œâ”€ Parses JSON
   â””â”€ setQuoteData(prev => {...prev, ...newData})
   â””â”€ setPreviewSliderOpen(true)

State after first update:
â”œâ”€ chatHistory: [user msg, assistant msg with JSON]
â”œâ”€ quoteData: {width: 40, height: 20, screenArea: 800}
â”œâ”€ previewSliderOpen: true âœ“ (slider now visible)
â””â”€ generatingProposal: false

User answers next question:
â””â”€ chatHistory updated again
â””â”€ useEffect triggers again
â””â”€ setQuoteData merges new fields
â””â”€ Slider automatically updates with new data

User clicks "Download PDF":
â””â”€ handleDownloadPdf() called
â”œâ”€ setGeneratingProposal(true) â†’ buttons show loading
â”œâ”€ API call to /generate-proposal
â”œâ”€ Response received
â”œâ”€ Browser download triggered
â””â”€ setGeneratingProposal(false) â†’ loading stops, success toast
```

---

## JSON Block Format & Parsing

```
AI Response Message:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ "Perfect! A 40x20 outdoor display is a great    â”‚
â”‚  choice. That's 800 square feet of display      â”‚
â”‚  area. Let me show you pricing...               â”‚
â”‚                                                  â”‚
â”‚  ```json                                        â”‚
â”‚  {                                              â”‚
â”‚    "width": 40,                                 â”‚
â”‚    "height": 20,                                â”‚
â”‚    "environment": "Outdoor",                    â”‚
â”‚    "screenArea": 800                            â”‚
â”‚  }                                              â”‚
â”‚  ```"                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Parsing Steps:
1. Regex Match: /```json\s*\n?([\s\S]*?)\n?```/
   â””â”€ Extracts: {"width": 40, "height": 20, ...}

2. JSON.parse()
   â””â”€ Converts string to object

3. Field Validation
   â”œâ”€ Check: width (allowed? âœ“)
   â”œâ”€ Check: height (allowed? âœ“)
   â”œâ”€ Check: environment (allowed? âœ“)
   â””â”€ Check: screenArea (allowed? âœ“)

4. State Merge
   â””â”€ setQuoteData(prev => ({...prev, ...jsonData}))

5. Auto-open Slider
   â””â”€ if (Object.keys(jsonData).length > 0)
   â””â”€ setPreviewSliderOpen(true)

Result:
â”œâ”€ quoteData updated âœ“
â”œâ”€ Slider visible âœ“
â””â”€ JSON hidden from user âœ“
```

---

## Hidden JSON Implementation

```
Original Message Display:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assistant: "Perfect! That's..."    â”‚
â”‚                                    â”‚
â”‚ ```json                            â”‚
â”‚ {"width": 40, "height": 20}        â”‚
â”‚ ```                                â”‚
â”‚                                    â”‚
â”‚ User: "What's the next question?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

With JSON Hiding:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Assistant: "Perfect! That's..."    â”‚
â”‚                                    â”‚
â”‚ [JSON CODE BLOCK HIDDEN]           â”‚
â”‚                                    â”‚
â”‚ User: "What's the next question?"  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Code Implementation (HistoricalMessage):
const code = ({ node, inline, className, children, ...props }) => {
  const lang = /language-(\w+)/.exec(className)?.[1];
  
  // Hide JSON blocks
  if (lang === "json" && children.includes("width")) {
    return null;  // Don't render anything
  }
  
  // Render other code blocks normally
  return <code>{children}</code>;
};

Benefits:
â”œâ”€ JSON still parsed (no loss of data)
â”œâ”€ User doesn't see ugly JSON
â”œâ”€ Clean, professional chat appearance
â””â”€ 100% reliable data transfer
```

---

**Architecture Complete & Production-Ready** âœ…
